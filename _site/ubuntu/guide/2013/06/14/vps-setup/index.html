<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
  <title>Poignant Code</title>
    <meta charset="utf-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>VPS Setup - Poignant Code</title>
    <meta name="description" content="I am a web developer who works at George Mason University. I love anything Web related, new technologies, all things nerdy, coffee roasting, homebrewing and things dealing with statistics and data. I also co-founded and help run the best meetup group around, Arlington Ruby!
">
    <meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="og:title" content="VPS Setup - Poignant Code"><meta property="og:site_name" content="Poignant Code"><meta property="og:description" content="I am a web developer who works at George Mason University. I love anything Web related, new technologies, all things nerdy, coffee roasting, homebrewing and things dealing with statistics and data. I also co-founded and help run the best meetup group around, Arlington Ruby!"><meta property="og:url" content="http://localhost:4000/ubuntu/guide/2013/06/14/vps-setup/"><meta property="article:published_time" content="2013-06-14T18:00:55-06:00"><meta property="article:author" content="http://localhost:4000/about">

    

    

    <link rel="alternate" type="application/rss+xml" href="http://localhost:4000/feed.xml">
    <link rel="shortcut icon" href="http://localhost:4000/favicon.ico">
    <link rel="prefetch" href="http://localhost:4000">
    <link rel="canonical" href="http://localhost:4000/ubuntu/guide/2013/06/14/vps-setup/">
    <link rel="stylesheet"
    href="http://localhost:4000/assets/css/main.css">

    <!-- IE Fixes -->
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <style type="text/css">a,.post-title a{color:#104E8B}a:hover{border-bottom-color:#104E8B}.sidebar{background-color:#104E8B}.wc-top,.sidebar-toggle:active,#sidebar-checkbox:checked ~ .sidebar-toggle{background-color:#104E8B}.sidebar a:hover,.sidebar .sidebar-nav a{border-bottom-color:#135ba2}.sidebar .sidebar-nav{border-top-color:#135ba2}.sidebar .sidebar-nav a.sidebar-nav-item:hover,.sidebar .sidebar-nav a.sidebar-nav-item:focus{background:#125699}.sidebar .sidebar-nav .sidebar-nav-item.active{background-color:#0e467d}ul.social-media li>a{background-color:#0e467d;border-color:#135ba2;border-bottom-color:#135ba2 !important}ul.social-media li>a:hover{background-color:#a5cdf5}.btn{border-color:#104E8B;background:#104e8b}.btn:hover,.btn:focus{border-color:#0d4174;background:#0d4174}</style>
  </head>
  <body>
    <input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox"><div class="sidebar" id="sidebar">    <img    src="http://localhost:4000/assets/images/avatars.jpg"    alt="Poignant Code" />    <div class="sidebar-info">      <p>        I am a web developer who works at George Mason University. I love anything Web related, new technologies, all things nerdy, coffee roasting, homebrewing and things dealing with statistics and data. I also co-founded and help run the best meetup group around, Arlington Ruby!      </p>  </div>  <nav class="sidebar-nav">    <a class="sidebar-nav-item"      href="http://localhost:4000/">      Home    </a>                        <a class="sidebar-nav-item "      href="http://localhost:4000/about">      About me    </a>                        <a class="sidebar-nav-item "      href="http://localhost:4000/archive">      Blog Archive    </a>                        <a class="sidebar-nav-item "      href="http://localhost:4000/r4g">      Ruby for Good    </a>                        <a class="sidebar-nav-item "      href="http://localhost:4000/golang">      Golang Resources    </a>        <a class="sidebar-nav-item"      href="http://github.com/seanmarcia"      target="_blank">      GitHub/Download    </a>  </nav>  <div class="sidebar-info small">     <p>     </p>  </div>  <ul class="social-media">        <li>        <a title="seanmarcia on Twitter"            href="https://twitter.com/seanmarcia"            class="twitter wc-img-replace" target="_blank">Twitter</a>    </li>            <li>        <a title="+seanmarcia on Google Plus"            href="https://plus.google.com/+seanmarcia"            class="google wc-img-replace" target="_blank">Google</a>    </li>                <li>        <a title="seanmarcia on Github"            href="https://github.com/seanmarcia"            class="github wc-img-replace" target="_blank">Github</a>    </li>                <li>        <a title="Subscribe via RSS"            href="http://localhost:4000/feed.xml"            class="rss wc-img-replace" target="_blank">            RSS        </a>    </li></ul></div>
    <div class="main-wrapper">
      <div class="header">
        <div class="container">
          <div class="header-title">
            <a href="http://localhost:4000/"
              title="Poignant Code">
              <h1>Poignant Code</h1>
              <h3><small>“when you don’t create things, you become defined by your tastes rather than ability. your tastes only narrow & exclude people. so create. ― Why The Lucky Stiff”</small></h3>
            </a>
          </div>
        </div>
      </div>

      <div class="container content">
          <div class="post">

  

  

  <header class="post-header">
    <h1 class="post-title">VPS Setup</h1>
    <p class="post-meta">
    
      <span class="categories">
      ubuntu and guide
      </span> |
    
    <span class="post-date">
    Jun 14, 2013  
    </span>
    </p>
  </header>

  <article class="post-content">
    <p>I recently built a rails app that needed more than the free level provided at Heroku so I decided to provision my own VPS and I thought I’d give the steps I followed to help someone else doing the same thing.</p>

<p>I’m making the following assumptions:
You have a github account and know how to <a href="(https://help.github.com/articles/generating-ssh-keys)">generate SSH keys</a>.
You can work with a command line editor like vim/emacs/pico
Your using a debian based linux distro on your VPS, I’m using Ubuntu 12.04 LTS
If you don’t have a VPS, most people recommend <a href="(https://www.linode.com/)">Linode</a> since it beats both <a href="(http://aws.amazon.com/ec2/)">EC2</a> and <a href="(https://www.digitalocean.com/)">Digital Ocean</a> when <a href="(http://www.cosninix.com/wp/2013/06/amazon-aws-ec2-linode-digitalocean-cloudserver-showdown/)">compared head-to-head</a> but since I was being thrifty and I didn’t need that level of performance, I went with Digital Ocean’s cheapest plan.</p>

<p>Assuming you have your server provisioned, you need to ssh into it, add a user (you don’t need to create a user with the name Sean, but you can) and give the user sudo access.</p>

<p>Setting up the server</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">ssh</span> <span class="n">root</span><span class="vi">@server</span><span class="o">-</span><span class="n">ip</span><span class="o">-</span><span class="n">address</span></code></pre></div>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="err">$</span> <span class="n">adduser</span> <span class="n">sean</span>
<span class="no">Adding</span> <span class="n">user</span> <span class="sb">`sean&#39; ...</span>
<span class="sb">Adding new group `</span><span class="n">sean</span><span class="s1">&#39; (1001) ...</span>
<span class="s1">Adding new user `sean&#39;</span> <span class="p">(</span><span class="mi">1001</span><span class="p">)</span> <span class="n">with</span> <span class="n">group</span> <span class="sb">`sean&#39; ...</span>
<span class="sb">Creating home directory `</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">sean</span><span class="s1">&#39; ...</span>
<span class="s1">Copying files from `/etc/skel&#39;</span> <span class="o">.</span><span class="n">.</span><span class="o">.</span>
<span class="no">Enter</span> <span class="kp">new</span> <span class="no">UNIX</span> <span class="ss">password</span><span class="p">:</span>
<span class="no">Retype</span> <span class="kp">new</span> <span class="no">UNIX</span> <span class="ss">password</span><span class="p">:</span>
<span class="ss">passwd</span><span class="p">:</span> <span class="n">password</span> <span class="n">updated</span> <span class="n">successfully</span>
<span class="no">Changing</span> <span class="n">the</span> <span class="n">user</span> <span class="n">information</span> <span class="k">for</span> <span class="n">sean</span>
<span class="no">Enter</span> <span class="n">the</span> <span class="kp">new</span> <span class="n">value</span><span class="p">,</span> <span class="ow">or</span> <span class="n">press</span> <span class="no">ENTER</span> <span class="k">for</span> <span class="n">the</span> <span class="n">default</span>
        <span class="no">Full</span> <span class="no">Name</span> <span class="o">[]</span><span class="p">:</span> <span class="no">Sean</span>
        <span class="no">Room</span> <span class="no">Number</span> <span class="o">[]</span><span class="p">:</span>
        <span class="no">Work</span> <span class="no">Phone</span> <span class="o">[]</span><span class="p">:</span>
        <span class="no">Home</span> <span class="no">Phone</span> <span class="o">[]</span><span class="p">:</span>
        <span class="no">Other</span> <span class="o">[]</span><span class="p">:</span>
<span class="no">Is</span> <span class="n">the</span> <span class="n">information</span> <span class="n">correct?</span> <span class="o">[</span><span class="n">Y</span><span class="o">/</span><span class="n">n</span><span class="o">]</span> <span class="n">y</span>
<span class="err">$</span></code></pre></div>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="err">$</span> <span class="n">visudo</span></code></pre></div>

<p>Edit the file so that it looks something like this:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">Defaults</span>        <span class="n">env_reset</span>
<span class="no">Defaults</span>        <span class="n">secure_path</span><span class="o">=</span><span class="s2">&quot;/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;</span>

<span class="n">root</span>    <span class="no">ALL</span><span class="o">=</span><span class="p">(</span><span class="ss">ALL</span><span class="p">:</span><span class="no">ALL</span><span class="p">)</span> <span class="no">ALL</span>
<span class="n">sean</span>    <span class="no">ALL</span><span class="o">=</span><span class="p">(</span><span class="ss">ALL</span><span class="p">:</span><span class="no">ALL</span><span class="p">)</span> <span class="no">ALL</span>

<span class="o">%</span><span class="n">admin</span> <span class="no">ALL</span><span class="o">=</span><span class="p">(</span><span class="no">ALL</span><span class="p">)</span> <span class="no">ALL</span>

<span class="o">%</span><span class="n">sudo</span>   <span class="no">ALL</span><span class="o">=</span><span class="p">(</span><span class="ss">ALL</span><span class="p">:</span><span class="no">ALL</span><span class="p">)</span> <span class="no">ALL</span></code></pre></div>

<p>You should now exit your server and copy your public key to your server, you can copy and paste or just use the scp command. For me the command was:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">scp</span> <span class="o">~</span><span class="sr">/.ssh/i</span><span class="n">d_rsa</span><span class="o">.</span><span class="n">pub</span> <span class="n">sean</span><span class="vi">@server</span><span class="o">-</span><span class="n">ip</span><span class="o">-</span><span class="ss">address</span><span class="p">:</span><span class="o">.</span><span class="n">ssh</span><span class="o">/</span><span class="n">authorized_keys</span></code></pre></div>

<p>Now ssh back into your server using your public key. If this doesn’t work, ssh back in using your password you set when you created the account and do the following:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="err">$</span> <span class="n">sudo</span> <span class="n">vim</span> <span class="sr">/etc/ss</span><span class="n">h</span><span class="o">/</span><span class="n">sshd_config</span></code></pre></div>

<p>Set the following entries to yes in the sshd_config file:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">RSAAuthentication</span> <span class="n">yes</span>
<span class="no">PubkeyAuthentication</span> <span class="n">yes</span></code></pre></div>

<p>After making the change, reload the the ssh configuration file:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="err">$</span> <span class="n">sudo</span> <span class="n">service</span> <span class="n">ssh</span> <span class="n">reload</span></code></pre></div>

<p>Note: if the service command failed run this command:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="err">$</span> <span class="n">sudo</span> <span class="sr">/etc/ini</span><span class="n">t</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">ssh</span> <span class="n">reload</span></code></pre></div>

<p>Exit the server and you should now be able to log in without using a password. Next disable password logins by again editing the sshd_config file and changing the following values to no:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">ChallengeResponseAuthentication</span> <span class="n">no</span>
<span class="no">PasswordAuthentication</span> <span class="n">no</span>
<span class="no">UsePAM</span> <span class="n">no</span></code></pre></div>

<p>Reload the ssh config as before. You should also at this point set up ssh keys on your server and add those keys to your github profile, assuming you are going to be deploying from github. At the top of this article I posted a link to github with their directions on creating ssh keys.</p>

<p>Installing Ruby
We should make sure our system is up to date before installing anything:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="err">$</span> <span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">update</span></code></pre></div>

<p>Now we can start with the actual ruby and rails installation. Before we can install rvm we need to install all the rvm dependencies.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="err">$</span> <span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">build</span><span class="o">-</span><span class="n">essential</span> <span class="n">openssl</span> <span class="n">libreadline6</span> <span class="n">libreadline6</span><span class="o">-</span><span class="n">dev</span> <span class="n">curl</span> <span class="n">git</span><span class="o">-</span><span class="n">core</span> <span class="n">zlib1g</span> <span class="n">zlib1g</span><span class="o">-</span><span class="n">dev</span> <span class="n">libssl</span><span class="o">-</span><span class="n">dev</span> <span class="n">libyaml</span><span class="o">-</span><span class="n">dev</span> <span class="n">libsqlite3</span><span class="o">-</span><span class="n">dev</span> <span class="n">sqlite3</span> <span class="n">libxml2</span><span class="o">-</span><span class="n">dev</span> <span class="n">libxslt</span><span class="o">-</span><span class="n">dev</span> <span class="n">autoconf</span> <span class="n">libc6</span><span class="o">-</span><span class="n">dev</span> <span class="n">ncurses</span><span class="o">-</span><span class="n">dev</span> <span class="n">automake</span> <span class="n">libtool</span> <span class="n">bison</span> <span class="n">subversion</span> <span class="n">pkg</span><span class="o">-</span><span class="n">config</span></code></pre></div>

<p>Then we install RVM</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="err">$</span> <span class="p">\</span><span class="n">curl</span> <span class="o">-</span><span class="n">L</span> <span class="ss">https</span><span class="p">:</span><span class="sr">//</span><span class="n">get</span><span class="o">.</span><span class="n">rvm</span><span class="o">.</span><span class="n">io</span> <span class="o">|</span> <span class="n">bash</span></code></pre></div>

<p>Then reload rvm.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="err">$</span> <span class="n">rvm</span> <span class="n">reload</span></code></pre></div>

<p>Then install ruby.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="err">$</span> <span class="n">rvm</span> <span class="n">install</span> <span class="mi">2</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">0</span></code></pre></div>

<p>Now install passenger.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="err">$</span> <span class="n">rvmsudo</span> <span class="n">gem</span> <span class="n">install</span> <span class="n">passenger</span></code></pre></div>

<p>If you want you can create a gemset for your application. If you are not planning on using your VPS for anything other than hosting this app this is probably not needed. Here is how you do it (my app is called pompeii.)</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="err">$</span> <span class="n">rvm</span> <span class="n">gemset</span> <span class="n">create</span> <span class="n">pompeii</span></code></pre></div>

<p>Webserver - Nginx
Now to install Nginx we first need to install the curl development headers with SSL support:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="err">$</span> <span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">libcurl4</span><span class="o">-</span><span class="n">openssl</span><span class="o">-</span><span class="n">dev</span></code></pre></div>

<p>Then install Nginx:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="err">$</span> <span class="n">rvmsudo</span> <span class="n">passenger</span><span class="o">-</span><span class="n">install</span><span class="o">-</span><span class="n">nginx</span><span class="o">-</span><span class="n">module</span></code></pre></div>

<p>Now we need to configure Nginx for our application vim /opt/nginx/conf/nginx.conf and in the http section add the following:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">server</span> <span class="p">{</span>
    <span class="n">client_max_body_size</span> <span class="mi">20</span><span class="n">M</span><span class="p">;</span>
    <span class="n">listen</span>       <span class="mi">80</span><span class="p">;</span>
  <span class="n">server_name</span> <span class="n">mydomain</span><span class="o">.</span><span class="n">com</span><span class="p">;</span>
  <span class="n">root</span> <span class="sr">/home/se</span><span class="n">an</span><span class="o">/</span><span class="n">pompeii</span><span class="o">/</span><span class="n">current</span><span class="o">/</span><span class="kp">public</span><span class="p">;</span>  <span class="c1"># You&#39;ll want to change this to your application name/home directory</span>
  <span class="n">passenger_enabled</span> <span class="n">on</span><span class="p">;</span>

   <span class="n">location</span> <span class="vi">@app</span> <span class="p">{</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></div>

<p>You don’t strictly need to add the line client_max_body_size 20M; unless you plan on transferring large files to/from your app. Next we need to get the linode init script and make nginx start when the server starts with the following:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="err">$</span> <span class="n">wget</span> <span class="o">-</span><span class="n">O</span> <span class="n">init</span><span class="o">-</span><span class="n">deb</span><span class="o">.</span><span class="n">sh</span> <span class="ss">http</span><span class="p">:</span><span class="sr">//</span><span class="n">library</span><span class="o">.</span><span class="n">linode</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">assets</span><span class="o">/</span><span class="mi">660</span><span class="o">-</span><span class="n">init</span><span class="o">-</span><span class="n">deb</span><span class="o">.</span><span class="n">sh</span>
<span class="err">$</span> <span class="n">sudo</span> <span class="n">mv</span> <span class="n">init</span><span class="o">-</span><span class="n">deb</span><span class="o">.</span><span class="n">sh</span> <span class="sr">/etc/ini</span><span class="n">t</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">nginx</span>
<span class="err">$</span> <span class="n">sudo</span> <span class="n">chmod</span> <span class="o">+</span><span class="n">x</span> <span class="sr">/etc/ini</span><span class="n">t</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">nginx</span>
<span class="err">$</span> <span class="n">sudo</span> <span class="sr">/usr/s</span><span class="n">bin</span><span class="o">/</span><span class="n">update</span><span class="o">-</span><span class="n">rc</span><span class="o">.</span><span class="n">d</span> <span class="o">-</span><span class="n">f</span> <span class="n">nginx</span> <span class="n">defaults</span></code></pre></div>

<p>Then just restart Nginx and you are good to go:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="err">$</span> <span class="n">sudo</span> <span class="sr">/etc/ini</span><span class="n">t</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">nginx</span> <span class="n">stop</span>
<span class="err">$</span> <span class="n">sudo</span> <span class="sr">/etc/ini</span><span class="n">t</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">nginx</span> <span class="n">start</span></code></pre></div>

<p>Database - Postgres
Now on to installing our database. I used Postgresql that you install with the following command:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="err">$</span> <span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">postgresql</span> <span class="n">libpq</span><span class="o">-</span><span class="n">dev</span></code></pre></div>

<p>We need to give our application a role and give it the ability to create databases/tables and login.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="err">$</span> <span class="n">sudo</span> <span class="n">su</span> <span class="o">-</span> <span class="n">postgres</span>
<span class="err">$</span> <span class="n">psql</span>   <span class="c1"># Enter the postgresql command line</span>
<span class="no">CREATE</span> <span class="no">ROLE</span> <span class="n">sean</span> <span class="no">WITH</span> <span class="no">LOGIN</span> <span class="no">CREATEDB</span><span class="p">;</span>
<span class="p">\</span><span class="n">q</span></code></pre></div>

<p>Now just create your database:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">createdb</span> <span class="n">pompeii</span> <span class="o">-</span><span class="n">O</span> <span class="n">sean</span>
<span class="no">Deployment</span> <span class="o">-</span> <span class="no">Capistrano</span></code></pre></div>

<p>Now we just need to set up capistrano and we are good to go. Just add the following gems to your gemfile:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">gem</span> <span class="s1">&#39;capistrano&#39;</span>
<span class="n">gem</span> <span class="s1">&#39;rvm-capistrano&#39;</span></code></pre></div>

<p>Then enter the following command from your command line on your development machine: capify . Your Capfile should look like this:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">load</span> <span class="s1">&#39;deploy&#39;</span>
<span class="nb">load</span> <span class="s1">&#39;deploy/assets&#39;</span>
<span class="nb">load</span> <span class="s1">&#39;config/deploy&#39;</span></code></pre></div>

<p>Your deploy.rb should look something like this:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">require</span> <span class="s2">&quot;rvm/capistrano&quot;</span>
<span class="nb">require</span> <span class="s2">&quot;bundler/capistrano&quot;</span>

<span class="n">set</span> <span class="ss">:deploy_to</span><span class="p">,</span> <span class="s2">&quot;/home/sean/pompeii&quot;</span>
<span class="n">set</span> <span class="ss">:repository</span><span class="p">,</span>  <span class="s2">&quot;https://github.com/SeanMarcia/pompeii.git&quot;</span>
<span class="n">set</span> <span class="ss">:rvm_type</span><span class="p">,</span> <span class="ss">:user</span>
<span class="n">set</span> <span class="ss">:rvm_ruby_string</span><span class="p">,</span> <span class="ss">:local</span>
<span class="n">set</span> <span class="ss">:use_sudo</span><span class="p">,</span> <span class="kp">false</span>
<span class="n">set</span> <span class="ss">:deploy_via</span><span class="p">,</span> <span class="ss">:remote_cache</span>

<span class="n">set</span> <span class="ss">:user</span><span class="p">,</span> <span class="s2">&quot;sean&quot;</span>
<span class="n">role</span> <span class="ss">:web</span><span class="p">,</span> <span class="s2">&quot;mywebip&quot;</span>
<span class="n">role</span> <span class="ss">:app</span><span class="p">,</span> <span class="s2">&quot;mywebip&quot;</span>
<span class="n">role</span> <span class="ss">:db</span><span class="p">,</span>  <span class="s2">&quot;mywebip&quot;</span><span class="p">,</span> <span class="ss">:primary</span> <span class="o">=&gt;</span> <span class="kp">true</span>

<span class="n">after</span> <span class="s2">&quot;deploy:restart&quot;</span><span class="p">,</span> <span class="s2">&quot;deploy:cleanup&quot;</span>
<span class="n">after</span> <span class="s2">&quot;deploy&quot;</span><span class="p">,</span> <span class="s2">&quot;rvm:trust_rvmrc&quot;</span>

<span class="n">namespace</span> <span class="ss">:deploy</span> <span class="k">do</span>
  <span class="n">task</span> <span class="ss">:start</span> <span class="k">do</span> <span class="p">;</span> <span class="k">end</span>
  <span class="n">task</span> <span class="ss">:stop</span> <span class="k">do</span> <span class="p">;</span> <span class="k">end</span>
  <span class="n">task</span> <span class="ss">:restart</span><span class="p">,</span> <span class="ss">:roles</span> <span class="o">=&gt;</span> <span class="ss">:app</span><span class="p">,</span> <span class="ss">:except</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:no_release</span> <span class="o">=&gt;</span> <span class="kp">true</span> <span class="p">}</span> <span class="k">do</span>
    <span class="n">run</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">try_sudo</span><span class="si">}</span><span class="s2"> touch </span><span class="si">#{</span><span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_path</span><span class="p">,</span><span class="s1">&#39;tmp&#39;</span><span class="p">,</span><span class="s1">&#39;restart.txt&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">namespace</span> <span class="ss">:rvm</span> <span class="k">do</span>
  <span class="n">task</span> <span class="ss">:trust_rvmrc</span> <span class="k">do</span>
    <span class="n">run</span> <span class="s2">&quot;rvm rvmrc trust </span><span class="si">#{</span><span class="n">release_path</span><span class="si">}</span><span class="s2">&quot;</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></div>

<p>Assuming you want capistrano to setup and create the directories for you:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">cap</span> <span class="ss">deploy</span><span class="p">:</span><span class="n">setup</span></code></pre></div>

<p>Now test to make sure there are no errors with:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">cap</span> <span class="ss">deploy</span><span class="p">:</span><span class="n">check</span></code></pre></div>

<p>Use cap deploy:cold the first time you deploy, after that `cap deploy’ is going to be all you need.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">cap</span> <span class="ss">deploy</span><span class="p">:</span><span class="n">cold</span></code></pre></div>

<p>Finally migrate your database and you should be good to go.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">cap</span> <span class="ss">deploy</span><span class="p">:</span><span class="n">migrate</span></code></pre></div>

<p>This is only a fraction of my deploy script, I have tasks in there to restart solr for search and to precompile my assets to speed up my deployment but this should be enough to get you going. Hopefully your site is now live and on the web!</p>

    
  </article>

  
    <div class="related-posts">
      <h4>Related Posts</h4>
      <ul>
        
          <li>
            <h5>
              <a href="http://localhost:4000/ruby/community/2014/12/14/rubyconf-au/">
                Rubyconf Australia Retrospective
                <small>14 Dec 2014</small>
              </a>
            </h5>
          </li>
        
          <li>
            <h5>
              <a href="http://localhost:4000/ruby/meetups/2014/12/14/arlington-ruby/">
                Reflecting on Arlington Ruby
                <small>14 Dec 2014</small>
              </a>
            </h5>
          </li>
        
          <li>
            <h5>
              <a href="http://localhost:4000/devops/guide/2014/10/27/refactoring-towards-celluloid/">
                Refactoring towards Celluloid
                <small>27 Oct 2014</small>
              </a>
            </h5>
          </li>
        
      </ul>
    </div>
  

  <div class="author-info">
    
      <div class="author">   <a href="http://localhost:4000/about">    <img       src="http://localhost:4000/assets/images/avatars.jpg"      alt="Poignant Code" width="60" height="60" />  </a>    <h5>Author</h4>  <h6>    <a href="http://localhost:4000/about">      Sean Marcia    </a>  </h5>  <p>    Find me on            <a title="seanmarcia on Twitter"             href="https://twitter.com/seanmarcia"             class="twitter" target="_blank">Twitter</a>                     /        <a title="+seanmarcia on Google Plus"             href="https://plus.google.com/+seanmarcia"             class="google" target="_blank">Google</a>      </p></div>
    
  
    
      <div class="share-buttons">  <h5>Share this post on</h5>  <ul class="social-media">    <li>        <a title="seanmarcia on Twitter"           href="https://twitter.com/intent/tweet?original_referer=http://localhost:4000/ubuntu/guide/2013/06/14/vps-setup/&amp;text=VPS Setup&amp;url=http://localhost:4000/ubuntu/guide/2013/06/14/vps-setup/" class="twitter wc-img-replace" target="_blank">          Twitter        </a>    </li>       <li>        <a title="+seanmarcia on Google Plus"             href="https://plus.google.com/share?url=http://localhost:4000/ubuntu/guide/2013/06/14/vps-setup/"             class="google wc-img-replace" target="_blank">Google</a>    </li>    <li>        <a title=" on Facebook"             href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/ubuntu/guide/2013/06/14/vps-setup/&amp;t=VPS Setup"             class="facebook wc-img-replace" target="_blank">Facebook</a>    </li>  </ul></div>
      
  </div>
  
  
</div>

      </div>
      <a href="#0" class="wc-top">Top</a>

    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle">
      <span></span>
    </label>

    <script type="text/javascript">
      var config = {
        "browser_warning_page": "http://localhost:4000/browser-warning/",
        "disqus_shortname": ""
      };
      /* Browser support detection */
      var browserSupport = (function(){
        var htmlElemClasses = document.querySelector('html').className.split(' ');
        for ( var i = 0; i < htmlElemClasses.length; i += 1 ){
          var className = htmlElemClasses[i];
          if ( className === 'lt-ie9' ){
            return true;
          }
        }
      }());

      if (browserSupport){
        window.location="http://localhost:4000/browser-warning/";
      }

      /* To avoid render blocking css */
      var cb = function() {
        var l = document.createElement('link'); l.rel = 'stylesheet';
        l.href = 'http://fonts.googleapis.com/css?family=PT+Sans';
        var h = document.getElementsByTagName('head')[0]; h.parentNode.insertBefore(l, h);
      };
      var raf = requestAnimationFrame || mozRequestAnimationFrame ||
          webkitRequestAnimationFrame || msRequestAnimationFrame;
      if (raf) raf(cb);
      else window.addEventListener('load', cb);


    </script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script async type="text/javascript" src="http://localhost:4000/assets/js/gaya.min.js"></script>

    
    
  </body>
</html>