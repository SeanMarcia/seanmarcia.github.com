<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
  <title>Poignant Code</title>
    <meta charset="utf-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>SQL old School - Poignant Code</title>
    <meta name="description" content="I am a web developer who works at George Mason University. I love anything Web related, new technologies, all things nerdy, coffee roasting, homebrewing and things dealing with statistics and data. I also co-founded and help run the best meetup group around, Arlington Ruby!
">
    <meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="og:title" content="SQL old School - Poignant Code"><meta property="og:site_name" content="Poignant Code"><meta property="og:description" content="I am a web developer who works at George Mason University. I love anything Web related, new technologies, all things nerdy, coffee roasting, homebrewing and things dealing with statistics and data. I also co-founded and help run the best meetup group around, Arlington Ruby!"><meta property="og:url" content="http://localhost:4000/sql/2014/04/14/sql-old-school/"><meta property="article:published_time" content="2014-04-14T19:08:49-06:00"><meta property="article:author" content="http://localhost:4000/about">

    

    

    <link rel="alternate" type="application/rss+xml" href="http://localhost:4000/feed.xml">
    <link rel="shortcut icon" href="http://localhost:4000/favicon.ico">
    <link rel="prefetch" href="http://localhost:4000">
    <link rel="canonical" href="http://localhost:4000/sql/2014/04/14/sql-old-school/">
    <link rel="stylesheet"
    href="http://localhost:4000/assets/css/main.css">

    <!-- IE Fixes -->
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <style type="text/css">a,.post-title a{color:#104E8B}a:hover{border-bottom-color:#104E8B}.sidebar{background-color:#104E8B}.wc-top,.sidebar-toggle:active,#sidebar-checkbox:checked ~ .sidebar-toggle{background-color:#104E8B}.sidebar a:hover,.sidebar .sidebar-nav a{border-bottom-color:#135ba2}.sidebar .sidebar-nav{border-top-color:#135ba2}.sidebar .sidebar-nav a.sidebar-nav-item:hover,.sidebar .sidebar-nav a.sidebar-nav-item:focus{background:#125699}.sidebar .sidebar-nav .sidebar-nav-item.active{background-color:#0e467d}ul.social-media li>a{background-color:#0e467d;border-color:#135ba2;border-bottom-color:#135ba2 !important}ul.social-media li>a:hover{background-color:#a5cdf5}.btn{border-color:#104E8B;background:#104e8b}.btn:hover,.btn:focus{border-color:#0d4174;background:#0d4174}</style>
  </head>
  <body>
    <input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox"><div class="sidebar" id="sidebar">    <img    src="http://localhost:4000/assets/images/avatars.jpg"    alt="Poignant Code" />    <div class="sidebar-info">      <p>        I am a web developer who works at George Mason University. I love anything Web related, new technologies, all things nerdy, coffee roasting, homebrewing and things dealing with statistics and data. I also co-founded and help run the best meetup group around, Arlington Ruby!      </p>  </div>  <nav class="sidebar-nav">    <a class="sidebar-nav-item"      href="http://localhost:4000/">      Home    </a>                        <a class="sidebar-nav-item "      href="http://localhost:4000/about">      About me    </a>                        <a class="sidebar-nav-item "      href="http://localhost:4000/archive">      Blog Archive    </a>                        <a class="sidebar-nav-item "      href="http://localhost:4000/r4g">      Ruby for Good    </a>                        <a class="sidebar-nav-item "      href="http://localhost:4000/golang">      Golang Resources    </a>        <a class="sidebar-nav-item"      href="http://github.com/seanmarcia"      target="_blank">      GitHub/Download    </a>  </nav>  <div class="sidebar-info small">     <p>     </p>  </div>  <ul class="social-media">        <li>        <a title="seanmarcia on Twitter"            href="https://twitter.com/seanmarcia"            class="twitter wc-img-replace" target="_blank">Twitter</a>    </li>            <li>        <a title="+seanmarcia on Google Plus"            href="https://plus.google.com/+seanmarcia"            class="google wc-img-replace" target="_blank">Google</a>    </li>                <li>        <a title="seanmarcia on Github"            href="https://github.com/seanmarcia"            class="github wc-img-replace" target="_blank">Github</a>    </li>                <li>        <a title="Subscribe via RSS"            href="http://localhost:4000/feed.xml"            class="rss wc-img-replace" target="_blank">            RSS        </a>    </li></ul></div>
    <div class="main-wrapper">
      <div class="header">
        <div class="container">
          <div class="header-title">
            <a href="http://localhost:4000/"
              title="Poignant Code">
              <h1>Poignant Code</h1>
              <h3><small>“when you don’t create things, you become defined by your tastes rather than ability. your tastes only narrow & exclude people. so create. ― Why The Lucky Stiff”</small></h3>
            </a>
          </div>
        </div>
      </div>

      <div class="container content">
          <div class="post">

  

  

  <header class="post-header">
    <h1 class="post-title">SQL old School</h1>
    <p class="post-meta">
    
      <span class="categories">
      sql
      </span> |
    
    <span class="post-date">
    Apr 14, 2014  
    </span>
    </p>
  </header>

  <article class="post-content">
    <p>Those of us who use Rails and have access to its magnificent ORM often take for granted how much it gives us. This came up recently when I needed to find some duplicate entries using SQL queries. I’ve changed table names to keep things private but everything else is the same.</p>

<p>Let say you have a database table (songtable) of songs where you want to remove the all the duplicate songs. The database has the columns title, band and year. While it is possible to do this all in one table, something about me likes to create a temporary table, verify it and then replace the original table.</p>

<p>Simply start by creating your temporary table.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">CREATE</span> <span class="n">table</span> <span class="n">songtable_temp</span>
    <span class="p">(</span><span class="n">title</span>  <span class="n">varchar</span><span class="p">(</span><span class="mi">30</span><span class="p">),</span>
     <span class="n">band</span> <span class="n">varchar</span><span class="p">(</span><span class="mi">30</span><span class="p">),</span>
     <span class="n">year</span>   <span class="n">varchar</span><span class="p">(</span><span class="mi">10</span><span class="p">));</span></code></pre></div>

<p>Now that we have our temporary table we just throw in all the values from our original songtable making sure we use group by. Group by will catch all copies and consolidate them.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">INSERT</span> <span class="n">into</span> <span class="n">songtable_temp</span>
    <span class="no">SELECT</span> <span class="n">title</span><span class="p">,</span><span class="n">band</span><span class="p">,</span><span class="n">year</span>
    <span class="no">FROM</span> <span class="n">songtable</span>
    <span class="no">GROUP</span> <span class="no">BY</span> <span class="n">title</span><span class="p">,</span><span class="n">band</span><span class="p">,</span><span class="n">year</span></code></pre></div>

<p>In this example you would definitely need to group by title and band since multiple bands can record the same song and grouping by year might also be a good thing since bands often re-release versions of the song. Now that you have the correct values, you just need to clear the original table.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">TRUNCATE</span> <span class="n">table</span> <span class="n">songtable</span></code></pre></div>

<p>It is important you use truncate rather than delete or drop. Delete is generally just for removing specific rows and drop removes the table all together. Truncate removes everything from the table but keeps it structure intact. Now we can put all the values back into the first table with the duplicates removed.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">INSERT</span> <span class="n">into</span> <span class="n">songtable</span>
    <span class="no">SELECT</span> <span class="o">*</span> <span class="n">from</span> <span class="n">songtable_temp</span></code></pre></div>

<p>Now just drop the temporary table and you are finished.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">DROP</span> <span class="n">table</span> <span class="n">songtable_temp</span></code></pre></div>

    
  </article>

  
    <div class="related-posts">
      <h4>Related Posts</h4>
      <ul>
        
          <li>
            <h5>
              <a href="http://localhost:4000/ruby/community/2014/12/14/rubyconf-au/">
                Rubyconf Australia Retrospective
                <small>14 Dec 2014</small>
              </a>
            </h5>
          </li>
        
          <li>
            <h5>
              <a href="http://localhost:4000/ruby/meetups/2014/12/14/arlington-ruby/">
                Reflecting on Arlington Ruby
                <small>14 Dec 2014</small>
              </a>
            </h5>
          </li>
        
          <li>
            <h5>
              <a href="http://localhost:4000/devops/guide/2014/10/27/refactoring-towards-celluloid/">
                Refactoring towards Celluloid
                <small>27 Oct 2014</small>
              </a>
            </h5>
          </li>
        
      </ul>
    </div>
  

  <div class="author-info">
    
      <div class="author">   <a href="http://localhost:4000/about">    <img       src="http://localhost:4000/assets/images/avatars.jpg"      alt="Poignant Code" width="60" height="60" />  </a>    <h5>Author</h4>  <h6>    <a href="http://localhost:4000/about">      Sean Marcia    </a>  </h5>  <p>    Find me on            <a title="seanmarcia on Twitter"             href="https://twitter.com/seanmarcia"             class="twitter" target="_blank">Twitter</a>                     /        <a title="+seanmarcia on Google Plus"             href="https://plus.google.com/+seanmarcia"             class="google" target="_blank">Google</a>      </p></div>
    
  
    
      <div class="share-buttons">  <h5>Share this post on</h5>  <ul class="social-media">    <li>        <a title="seanmarcia on Twitter"           href="https://twitter.com/intent/tweet?original_referer=http://localhost:4000/sql/2014/04/14/sql-old-school/&amp;text=SQL old School&amp;url=http://localhost:4000/sql/2014/04/14/sql-old-school/" class="twitter wc-img-replace" target="_blank">          Twitter        </a>    </li>       <li>        <a title="+seanmarcia on Google Plus"             href="https://plus.google.com/share?url=http://localhost:4000/sql/2014/04/14/sql-old-school/"             class="google wc-img-replace" target="_blank">Google</a>    </li>    <li>        <a title=" on Facebook"             href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/sql/2014/04/14/sql-old-school/&amp;t=SQL old School"             class="facebook wc-img-replace" target="_blank">Facebook</a>    </li>  </ul></div>
      
  </div>
  
  
    <div class="comments">
        <a href="javascript:;" class="load-view">View Comments...</a>
        <div id="disqus_thread"></div>
        <div id="g-comments"></div>
    </div>
  
</div>

      </div>
      <a href="#0" class="wc-top">Top</a>

    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle">
      <span></span>
    </label>

    <script type="text/javascript">
      var config = {
        "browser_warning_page": "http://localhost:4000/browser-warning/",
        "disqus_shortname": ""
      };
      /* Browser support detection */
      var browserSupport = (function(){
        var htmlElemClasses = document.querySelector('html').className.split(' ');
        for ( var i = 0; i < htmlElemClasses.length; i += 1 ){
          var className = htmlElemClasses[i];
          if ( className === 'lt-ie9' ){
            return true;
          }
        }
      }());

      if (browserSupport){
        window.location="http://localhost:4000/browser-warning/";
      }

      /* To avoid render blocking css */
      var cb = function() {
        var l = document.createElement('link'); l.rel = 'stylesheet';
        l.href = 'http://fonts.googleapis.com/css?family=PT+Sans';
        var h = document.getElementsByTagName('head')[0]; h.parentNode.insertBefore(l, h);
      };
      var raf = requestAnimationFrame || mozRequestAnimationFrame ||
          webkitRequestAnimationFrame || msRequestAnimationFrame;
      if (raf) raf(cb);
      else window.addEventListener('load', cb);


    </script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script async type="text/javascript" src="http://localhost:4000/assets/js/gaya.min.js"></script>

    
    
  </body>
</html>